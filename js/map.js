function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 6,
    center: { lat: 40.2085, lng: -3.713 },
  });
  const infoWindow = new google.maps.InfoWindow({
    content: "",
    disableAutoPan: true,
  });
  // Create an array of alphabetical characters used to label the markers.
  // Add some markers to the map.
  const svgMarker = {
    path: "M10.453 14.016l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM12 2.016q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",
    fillColor: "#bead8e",
    fillOpacity: 1,
    strokeWeight: 0,
    rotation: 0,
    scale: 2,
    anchor: new google.maps.Point(15, 30),
  };
  const markers = locations.map((place) => {
    const marker = new google.maps.Marker({
      position: place.location,
      icon: svgMarker,
      title: place.name
    });

    // markers can only be keyboard focusable when they have click listeners
    // open info window when marker is clicked
    const coords =[
      {
          "lng": -5.3118896484375,
          "lat": 36.1312200154285
      },
      {
          "lng": -5.30914306640625,
          "lat": 36.20882309283712
      },
      {
          "lng": -5.1910400390625,
          "lat": 36.392545812446244
      },
      {
          "lng": -4.91912841796875,
          "lat": 36.485348924361425
      },
      {
          "lng": -4.67193603515625,
          "lat": 36.47872381162464
      },
      {
          "lng": -4.531860351562499,
          "lat": 36.56039393337068
      },
      {
          "lng": -4.40277099609375,
          "lat": 36.705861603381145
      },
      {
          "lng": -4.141845703125,
          "lat": 36.71466899719828
      },
      {
          "lng": -3.88641357421875,
          "lat": 36.730079507078415
      },
      {
          "lng": -3.50738525390625,
          "lat": 36.6992553955527
      },
      {
          "lng": -3.34808349609375,
          "lat": 36.71026542647845
      },
      {
          "lng": -3.2107543945312496,
          "lat": 36.74988847598359
      },
      {
          "lng": -3.00201416015625,
          "lat": 36.74108512094412
      },
      {
          "lng": -2.823486328125,
          "lat": 36.701457527917896
      },
      {
          "lng": -2.6806640625,
          "lat": 36.686041276581925
      },
      {
          "lng": -2.6174926757812496,
          "lat": 36.721273880045004
      },
      {
          "lng": -2.5543212890625,
          "lat": 36.8092847020594
      },
      {
          "lng": -2.4554443359375,
          "lat": 36.83127162140714
      },
      {
          "lng": -2.30438232421875,
          "lat": 36.81808022778526
      },
      {
          "lng": -2.2137451171875,
          "lat": 36.72347538145935
      },
      {
          "lng": -2.1450805664062496,
          "lat": 36.71026542647845
      },
      {
          "lng": -1.9857788085937502,
          "lat": 36.8510544475565
      },
      {
          "lng": -1.86767578125,
          "lat": 37.02886944696474
      },
      {
          "lng": -1.77978515625,
          "lat": 37.2368886685595
      },
      {
          "lng": -1.6259765625,
          "lat": 37.37424981026882
      },
      {
          "lng": -1.7368698120117188,
          "lat": 37.44215478101228
      },
      {
          "lng": -1.8103408813476565,
          "lat": 37.4519672738549
      },
      {
          "lng": -1.8079376220703125,
          "lat": 37.43288624495853
      },
      {
          "lng": -1.9246673583984375,
          "lat": 37.552743280459694
      },
      {
          "lng": -2.0129013061523438,
          "lat": 37.67240786750202
      },
      {
          "lng": -2.0094680786132812,
          "lat": 37.77722770873696
      },
      {
          "lng": -1.9727325439453125,
          "lat": 37.86943313301452
      },
      {
          "lng": -2.120361328125,
          "lat": 37.90113599940821
      },
      {
          "lng": -2.1701431274414062,
          "lat": 37.89029894809523
      },
      {
          "lng": -2.344207763671875,
          "lat": 38.02483602718798
      },
      {
          "lng": -2.54608154296875,
          "lat": 38.07998712800633
      },
      {
          "lng": -2.454071044921875,
          "lat": 38.18260873429114
      },
      {
          "lng": -2.439651489257812,
          "lat": 38.28050457181879
      },
      {
          "lng": -2.4805068969726562,
          "lat": 38.29694245262843
      },
      {
          "lng": -2.487030029296875,
          "lat": 38.39010980118257
      },
      {
          "lng": -2.5546646118164062,
          "lat": 38.40410147066251
      },
      {
          "lng": -2.5934600830078125,
          "lat": 38.511639141458616
      },
      {
          "lng": -2.684783935546875,
          "lat": 38.49874308602779
      },
      {
          "lng": -2.77130126953125,
          "lat": 38.53393312125598
      },
      {
          "lng": -2.8832244873046875,
          "lat": 38.45547070594816
      },
      {
          "lng": -2.959442138671875,
          "lat": 38.47240646975172
      },
      {
          "lng": -3.000640869140625,
          "lat": 38.4145934456796
      },
      {
          "lng": -3.0600357055664062,
          "lat": 38.48288852101284
      },
      {
          "lng": -3.127670288085937,
          "lat": 38.44310239838567
      },
      {
          "lng": -3.3134078979492188,
          "lat": 38.48046972138692
      },
      {
          "lng": -3.37005615234375,
          "lat": 38.47563187862808
      },
      {
          "lng": -3.4256744384765625,
          "lat": 38.4059847578341
      },
      {
          "lng": -3.5091018676757812,
          "lat": 38.406522830869775
      },
      {
          "lng": -3.5805130004882812,
          "lat": 38.4560084103617
      },
      {
          "lng": -3.6203384399414062,
          "lat": 38.40087286420115
      },
      {
          "lng": -3.80950927734375,
          "lat": 38.42508389732895
      },
      {
          "lng": -3.8551712036132812,
          "lat": 38.37799944020038
      },
      {
          "lng": -3.9825439453125,
          "lat": 38.36723297274062
      },
      {
          "lng": -4.275054931640624,
          "lat": 38.40168002933614
      },
      {
          "lng": -4.2681884765625,
          "lat": 38.350811025814814
      },
      {
          "lng": -4.28466796875,
          "lat": 38.34596449365382
      },
      {
          "lng": -4.467315673828125,
          "lat": 38.4207803065881
      },
      {
          "lng": -4.685325622558593,
          "lat": 38.5580995115263
      },
      {
          "lng": -4.857673645019531,
          "lat": 38.61177351991072
      },
      {
          "lng": -4.878959655761719,
          "lat": 38.68631373688367
      },
      {
          "lng": -5.0008392333984375,
          "lat": 38.693817085390684
      },
      {
          "lng": -5.042724609375,
          "lat": 38.7318576646415
      },
      {
          "lng": -5.097999572753906,
          "lat": 38.70989303926043
      },
      {
          "lng": -5.18280029296875,
          "lat": 38.71873327340352
      },
      {
          "lng": -5.181770324707031,
          "lat": 38.6686241590437
      },
      {
          "lng": -5.293006896972656,
          "lat": 38.60989560714296
      },
      {
          "lng": -5.307426452636719,
          "lat": 38.57796357021356
      },
      {
          "lng": -5.372314453125,
          "lat": 38.58467315983427
      },
      {
          "lng": -5.3853607177734375,
          "lat": 38.556488671509264
      },
      {
          "lng": -5.489387512207031,
          "lat": 38.46568640449255
      },
      {
          "lng": -5.580711364746094,
          "lat": 38.42024233971639
      },
      {
          "lng": -5.563888549804687,
          "lat": 38.37826858136171
      },
      {
          "lng": -5.57281494140625,
          "lat": 38.329807044201374
      },
      {
          "lng": -5.527153015136719,
          "lat": 38.27053224010455
      },
      {
          "lng": -5.523033142089844,
          "lat": 38.22307753495298
      },
      {
          "lng": -5.5377960205078125,
          "lat": 38.16479533621134
      },
      {
          "lng": -5.597190856933594,
          "lat": 38.1334763895322
      },
      {
          "lng": -5.6325531005859375,
          "lat": 38.13860713787158
      },
      {
          "lng": -5.697784423828125,
          "lat": 38.08377048360514
      },
      {
          "lng": -5.736579895019531,
          "lat": 38.08890472451228
      },
      {
          "lng": -5.738639831542969,
          "lat": 38.13428653167246
      },
      {
          "lng": -5.695037841796875,
          "lat": 38.154537162312145
      },
      {
          "lng": -5.700874328613281,
          "lat": 38.172622971624826
      },
      {
          "lng": -5.68267822265625,
          "lat": 38.15804670000032
      },
      {
          "lng": -5.692634582519531,
          "lat": 38.1847676381822
      },
      {
          "lng": -5.733146667480469,
          "lat": 38.19798952846822
      },
      {
          "lng": -5.881805419921875,
          "lat": 38.161016176890456
      },
      {
          "lng": -5.92884063720703,
          "lat": 38.10430528370985
      },
      {
          "lng": -5.9099578857421875,
          "lat": 38.068365597582506
      },
      {
          "lng": -5.949440002441406,
          "lat": 37.99724489645483
      },
      {
          "lng": -6.0143280029296875,
          "lat": 37.996162679728116
      },
      {
          "lng": -6.109428405761719,
          "lat": 37.985069037626516
      },
      {
          "lng": -6.181182861328125,
          "lat": 37.943926752499856
      },
      {
          "lng": -6.345634460449219,
          "lat": 37.9991387373021
      },
      {
          "lng": -6.368293762207031,
          "lat": 38.04944287754316
      },
      {
          "lng": -6.449317932128906,
          "lat": 38.05944549633448
      },
      {
          "lng": -6.474723815917969,
          "lat": 38.0091482264894
      },
      {
          "lng": -6.584587097167969,
          "lat": 38.02050869343087
      },
      {
          "lng": -6.581153869628906,
          "lat": 38.053768502070696
      },
      {
          "lng": -6.627159118652344,
          "lat": 38.09917212458053
      },
      {
          "lng": -6.737709045410155,
          "lat": 38.091066402284966
      },
      {
          "lng": -6.8149566650390625,
          "lat": 38.119162395618986
      },
      {
          "lng": -6.795387268066406,
          "lat": 38.17748108114799
      },
      {
          "lng": -6.855812072753906,
          "lat": 38.17937025849983
      },
      {
          "lng": -6.9330596923828125,
          "lat": 38.20770204069946
      },
      {
          "lng": -6.970138549804687,
          "lat": 38.161016176890456
      },
      {
          "lng": -6.956748962402344,
          "lat": 38.15156742157968
      },
      {
          "lng": -6.977348327636719,
          "lat": 38.10592620640843
      },
      {
          "lng": -7.0058441162109375,
          "lat": 38.023754217706944
      },
      {
          "lng": -7.061119079589844,
          "lat": 38.019967758742766
      },
      {
          "lng": -7.101287841796875,
          "lat": 38.04619849140099
      },
      {
          "lng": -7.1294403076171875,
          "lat": 38.02213147353745
      },
      {
          "lng": -7.12738037109375,
          "lat": 38.002655740556705
      },
      {
          "lng": -7.1775054931640625,
          "lat": 37.995351006703814
      },
      {
          "lng": -7.206344604492188,
          "lat": 38.00319680300937
      },
      {
          "lng": -7.266769409179688,
          "lat": 37.975597528091235
      },
      {
          "lng": -7.253723144531249,
          "lat": 37.93905311334205
      },
      {
          "lng": -7.2818756103515625,
          "lat": 37.8962595237529
      },
      {
          "lng": -7.304878234863281,
          "lat": 37.837445479729666
      },
      {
          "lng": -7.392425537109376,
          "lat": 37.769629187677
      },
      {
          "lng": -7.446327209472656,
          "lat": 37.691155980536266
      },
      {
          "lng": -7.503318786621093,
          "lat": 37.5856702356572
      },
      {
          "lng": -7.511215209960937,
          "lat": 37.52878726238273
      },
      {
          "lng": -7.441520690917969,
          "lat": 37.395527866984104
      },
      {
          "lng": -7.410621643066405,
          "lat": 37.180561015389465
      },
      {
          "lng": -7.3944854736328125,
          "lat": 37.16359980197957
      },
      {
          "lng": -7.33783721923828,
          "lat": 37.18384339111027
      },
      {
          "lng": -7.263336181640625,
          "lat": 37.20380810334558
      },
      {
          "lng": -7.0800018310546875,
          "lat": 37.20708946859002
      },
      {
          "lng": -6.9330596923828125,
          "lat": 37.16168458708581
      },
      {
          "lng": -6.739082336425781,
          "lat": 37.092430683283474
      },
      {
          "lng": -6.546478271484375,
          "lat": 36.99021354687846
      },
      {
          "lng": -6.456871032714844,
          "lat": 36.90982318631135
      },
      {
          "lng": -6.393699645996093,
          "lat": 36.79443996095986
      },
      {
          "lng": -6.443824768066406,
          "lat": 36.75098882435506
      },
      {
          "lng": -6.448287963867187,
          "lat": 36.712742466063354
      },
      {
          "lng": -6.395759582519531,
          "lat": 36.61332303966068
      },
      {
          "lng": -6.335334777832031,
          "lat": 36.53667433697152
      },
      {
          "lng": -6.253623962402344,
          "lat": 36.43951363839656
      },
      {
          "lng": -6.180839538574219,
          "lat": 36.359098472783266
      },
      {
          "lng": -6.12762451171875,
          "lat": 36.2628226848984
      },
      {
          "lng": -6.031837463378906,
          "lat": 36.17612830717087
      },
      {
          "lng": -5.915794372558594,
          "lat": 36.17973094416368
      },
      {
          "lng": -5.84197998046875,
          "lat": 36.11735423846348
      },
      {
          "lng": -5.802497863769531,
          "lat": 36.077407119583334
      },
      {
          "lng": -5.775375366210937,
          "lat": 36.08434383998265
      },
      {
          "lng": -5.726966857910156,
          "lat": 36.059368782721876
      },
      {
          "lng": -5.686798095703125,
          "lat": 36.064364428590025
      },
      {
          "lng": -5.615730285644531,
          "lat": 36.009394882511685
      },
      {
          "lng": -5.57830810546875,
          "lat": 36.003840269855914
      },
      {
          "lng": -5.495567321777344,
          "lat": 36.04743345598549
      },
      {
          "lng": -5.428276062011719,
          "lat": 36.056038175935186
      },
      {
          "lng": -5.41351318359375,
          "lat": 36.08295654486136
      },
      {
          "lng": -5.3118896484375,
          "lat": 36.1312200154285
      }
  ]
  const bermudaTriangle = new google.maps.Polygon({
    paths: coords,
    strokeColor: "#bead8e",
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillOpacity: 0,
  });

  bermudaTriangle.setMap(map);

    
    marker.addListener("click", () => {
      infoWindow.setContent(place.name);
      infoWindow.open(map, marker);
    });
    return marker;
  });

  // Add a marker clusterer to manage the markers.
  const markerCluster = new markerClusterer.MarkerClusterer({ map, markers });
  const locationButton = document.createElement("button");

  locationButton.textContent = "My Current Location";
  locationButton.classList.add("custom-map-control-button");
  map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
  locationButton.addEventListener("click", () => {
    // Try HTML5 geolocation.
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
          };

          infoWindow.setPosition(pos);
          infoWindow.setContent("Location found.");
          infoWindow.open(map);
          map.setCenter(pos);
        },
        () => {
          handleLocationError(true, infoWindow, map.getCenter());
        }
      );
    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false, infoWindow, map.getCenter());
    }
  });
}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  infoWindow.setPosition(pos);
  infoWindow.setContent(
    browserHasGeolocation
      ? "Error: The Geolocation service failed."
      : "Error: Your browser doesn't support geolocation."
  );
  infoWindow.open(map);
}

const locations = [
  {name: 'Madrid', location: {lat:40.4165, lng:  -3.70256}},
  {name: 'Sevilla', location: {lat:37.38283 , lng: -5.97317}},
  {name: 'Barcelona', location: {lat:41.38879, lng:  2.15899}},
  {name: 'Móstoles', location: {lat:40.32234 , lng:-3.86496 }},
  {name: 'Leganés', location: {lat:40.32718 , lng: -3.7635}},
  {name: 'Santander', location: {lat:43.46472, lng:  -3.80444}},
  {name: 'Oviedo', location: {lat:43.36029 , lng:-5.84476 }},
  {name: 'Logroño', location: {lat:42.46667 , lng: -2.45}},
  {name: 'Cáceres', location: {lat:39.47649 , lng: -6.37224}},
  {name: 'Ceuta', location: {lat:35.88933 , lng:-5.31979 }},
  {name: 'Cuenca', location: {lat:40.06667 , lng:-2.13333 }}
];